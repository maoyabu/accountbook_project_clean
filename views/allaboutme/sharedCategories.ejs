<% layout('layouts/boilerplate') -%>
<% page = 'sharedCategories' %>

<div class="container mt-4">
  <div class="text-end">
    <a href="https://colts-wish-krs.craft.me/UJ4Y7muYdOwQlH/b/1BEE7958-A1BF-425A-B3C6-416596371620/My-History-My-History%E8%A8%AD%E5%AE%9A"
      target="_blank" rel="noopener"
      class="badge bg-success text-white text-decoration-none p-2">
      ガイド
    </a>
  </div>
  <h2><i class="fas fa-users me-2"></i>全ユーザーで共有されたカテゴリー一覧</h2>
  <hr>

  <% if (categories.length === 0) { %>
    <p class="text-muted">現在、共有されているカテゴリーはありません。</p>
  <% } else { %>
    <div class="row">
      <% categories.forEach(category => { %>
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title"><%= category.name %></h5>
              <p class="card-text small">
                <strong>フィールド数:</strong> <%= category.fields.length %><br>
                <strong>作成者:</strong> <%= category.user.displayname || category.user.username %>
              </p>
              <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#categoryModal<%= category._id %>">
                閲覧
              </button>
            </div>
          </div>
        </div>

        <!-- モーダル -->
        <div class="modal fade" id="categoryModal<%= category._id %>" tabindex="-1" aria-labelledby="categoryModalLabel<%= category._id %>" aria-hidden="true">
          <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="categoryModalLabel<%= category._id %>"><%= category.name %> の詳細</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="閉じる"></button>
              </div>
              <div class="modal-body">
                <ul class="list-group">
                  <% category.fields.forEach(field => { %>
                    <li class="list-group-item">
                      <strong><%= field.name %></strong> - <%= field.type %>
                    </li>
                  <% }) %>
                </ul>
              </div>
              <div class="modal-footer">
                <form method="POST" action="/history/categories/import/<%= category._id %>">
                  <button type="submit" class="btn btn-primary">自分のカテゴリーに取り込む</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>
</div>