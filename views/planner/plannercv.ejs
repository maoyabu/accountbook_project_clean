<!DOCTYPE html>
<html lang="ja">
    <head>
    <meta charset="UTF-8">
    <title>Planner 職務履歴書</title>
    <style>
        body {
        font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        font-size: 14px;
        color: #000;
        background-color: #fff;
        padding: 20px;
        }
        .table {
        width: 100%;
        border-collapse: collapse;
        }
        .table td, .table th {
        border: 1px solid #ccc;
        padding: 8px;
        vertical-align: top;
        }
        .table th {
        background-color: #f5f5f5;
        text-align: center;
        }
        .text-center {
        text-align: center;
        }
        .text-end {
        text-align: right;
        }
        .mt-4 {
        margin-top: 1.5rem;
        }
        .mb-4 {
        margin-bottom: 1.5rem;
        }
        .category-label-box {
          display: inline-block;
          min-width: 200px;
          padding: 8px 12px;
          border-radius: 5px;
          color: white;
        }

        .section-title {
            border-bottom: 3px solid #007bff;
            padding-bottom: 5px;
            margin-bottom: 15px;
            font-weight: bold;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

    </head>
    <body>
<div class="container mt-4">
  <h2 class="text-center mb-4">Planner 職務履歴書</h2>
    <table class="table table-bordered" style="border-collapse: collapse;">
        <tbody>
        <tr>
            <td style="width: 15%;"><strong>氏名</strong></td>
            <td style="width: 35%;"><%= resume?.last_name || '' %> <%= resume?.first_name || '' %></td>
            <td rowspan="4" colspan="2" class="text-center align-middle" style="width: 30%;">
            <% if (resume?.photoBase64 || resume?.photo_url) { %>
                <img src="<%= resume.photoBase64 || resume.photo_url %>" class="img-fluid" alt="写真" style="max-width: 150px; max-height: 200px;">
            <% } else { %>
                写真未登録
            <% } %>
            </td>
        </tr>
        <tr>
            <td><strong>ふりがな</strong></td>
            <td><%= resume?.last_name_kana || '' %> <%= resume?.first_name_kana || '' %></td>
        </tr>
        <tr>
            <td><strong>メール</strong></td>
            <td><%= user?.email || '' %></td>
        </tr>
        <tr>
            <td><strong>生年月日・性別</strong></td>
            <td>
            生年月日：<%= user?.birth_date ? user.birth_date.toISOString().substring(0, 10) : '' %><br>
            性別：<%= user?.sex || '' %>
            </td>
        </tr>
        </tbody>
    </table>

    <div class="mt-2">
        <h5 class="section-title">職歴要約</h5>
        <p><%- resume?.summary?.replace(/\n/g, '<br>') %></p>
    </div>

    <% if (careerEntries && careerEntries.length > 0) { %>
      <div class="mt-4">
        <h5 class="section-title">職務経歴（Planner）</h5>
        <% careerEntries.forEach(entry => { %>
          <div class="card mb-3">
            <div class="card-header d-flex justify-content-between align-items-center">
              <strong><%= entry.company %> <%= entry.department %></strong><small><%= entry.from_date_str %>〜<%= entry.end_date_str %> (<%= entry.age_range %>)</small>
              <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#plannerDetailModal_<%= entry._id %>">詳細</button>
            </div>
            <div class="card-body">
              <p><strong>職場：</strong><%= entry.company %></p>
              <p><strong>仕事内容：</strong><%- entry.summary?.replace(/\n/g, '<br>') %></p>
            </div>
          </div>

          <!-- モーダル -->
          <div class="modal fade" id="plannerDetailModal_<%= entry._id %>" tabindex="-1" aria-labelledby="modalLabel_<%= entry._id %>" aria-hidden="true">
            <div class="modal-dialog modal-lg">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="modalLabel_<%= entry._id %>">詳細情報</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="閉じる"></button>
                </div>
                <div class="modal-body">
                  <p><strong>職場：</strong><%= entry.company %></p>
                  <hr>
                  <p><strong>仕事内容：</strong></p>
                  <p><%- entry.summary?.replace(/\n/g, '<br>') %></p>
                  <p><strong>職務アピールポイント：</strong></p>
                  <p><%- entry.details?.replace(/\n/g, '<br>') %></p>
                </div>
              </div>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>

    <table>
        <tbody>
        <tr>
            <td colspan="4" style="border: 1px solid #ccc;">
            <div style="background-color: #f0f0f0; text-align: center; font-weight: bold;">自己PR</div>
            <div style="white-space: pre-line;"><%- resume?.self_promotion || '' %></div>
            </td>
        </tr>
        <tr>
            <td colspan="4" style="border: 1px solid #ccc;">
            <div style="background-color: #f0f0f0; text-align: center; font-weight: bold;">資格・特技</div>
            <div style="white-space: pre-line;"><%- resume?.skills || '' %></div>
            </td>
        </tr>
        <tr>
            <td colspan="4" style="border: 1px solid #ccc;">
            <div style="background-color: #f0f0f0; text-align: center; font-weight: bold;">活かせる経験・知識・技術等</div>
            <div style="white-space: pre-line;"><%- resume?.experience || '' %></div>
            </td>
        </tr>
        </tbody>
    </table>
</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    </body>
</html>