<% layout('layouts/boilerplate') %>
<% page = 'search' %>

<div class="text-end">
  <a href="https://colts-wish-krs.craft.me/UJ4Y7muYdOwQlH/b/33EAF36C-74B4-4157-BADD-9B777DF0BD2E/%E5%AE%B6%E8%A8%88%E7%B0%BF-%E6%9C%80%E8%BF%91%E3%81%AE%E5%85%A5%E5%8A%9B-%E6%A4%9C%E7%B4%A2-EXCEL%E6%9B%B8%E5%87%BA%E3%81%97"
     target="_blank" rel="noopener"
     class="badge bg-success text-white text-decoration-none p-2">
    ガイド
  </a>
</div>
    <div class="container mt-2">
      <div class="card shadow-sm">
        <div class="card-header text-white" style="background-color: #3a7ca5;">
          <h5 class="mb-0">検索条件</h5>
        </div>
        <div class="card-body">
            <form action="/finance/search" method="POST">
                <hr>
                <div class="form-group text-start">
                    <div class="d-flex flex-column flex-sm-row align-items-start gap-3">
                        <div class="d-flex align-items-center justify-content-start gap-1">
                        <label for="date" class="mb-0">開始</label>
                        <input type="date" id="date" name="date" class="form-control">
                      </div>
                      <div class="d-flex align-items-center justify-content-start gap-1">
                        <label for="date2" class="mb-0">終了</label>
                        <input type="date" id="date2" name="date2" class="form-control">
                      </div>
                    </div>
                </div>

                <div class="form-group text-start">
                    <label for="large_cf">収支区分</label>
                    <select name="cf" id="cf" class="form-control">
                        <% for (let la_cf of la_cfs) {%>
                            <option value="<%= la_cf %>"><%= la_cf %></option>
                        <% } %>
                    </select>
                </div>

                <!-- 支出区分 -->
                <div class="form-group category-group text-start mb-2" id="expense_group">
                    <div class="d-flex align-items-center">
                        <label for="expense_cf" class="me-2 mb-0" style="min-width: 90px;">支出区分</label>
                        <select name="expense_item" id="expense_cf" class="form-control">
                        <% for (let ex_cf of ex_cfs) {%>
                            <option value="<%= ex_cf %>"><%= ex_cf %></option>
                        <% } %>
                        </select>
                    </div>
                    <div class="d-flex align-items-center mt-2">
                        <label for="expense_cf2" class="me-2 mb-0" style="min-width: 90px;">支出区分2</label>
                        <select name="expense_item2" id="expense_cf2" class="form-control">
                        <% for (let ex_cf of ex_cfs) {%>
                            <option value="<%= ex_cf %>"><%= ex_cf %></option>
                        <% } %>
                        </select>
                    </div>
                </div>

                <!-- 収入区分 -->
                <div class="form-group category-group text-start mb-2" id="income_group">
                  <div class="d-flex align-items-center">
                    <label for="income_cf" class="me-2 mb-0" style="min-width: 90px;">収入区分</label>
                    <select name="income_item" id="income_cf" class="form-control">
                      <% for (let in_item of in_items) {%>
                        <option value="<%= in_item %>"><%= in_item %></option>
                      <% } %>
                        </select>
                    </div>
                    <div class="d-flex align-items-center mt-2">
                      <label for="income_cf2" class="me-2 mb-0" style="min-width: 90px;">収入区分2</label>
                      <select name="income_item2" id="income_cf2" class="form-control">
                        <% for (let in_item of in_items) {%>
                          <option value="<%= in_item %>"><%= in_item %></option>
                        <% } %>
                      </select>
                    </div>
                </div>

                <!-- 控除区分 -->
                <div class="form-group category-group text-start mb-2" id="deduction_group">
                  <div class="d-flex align-items-center">
                    <label for="dedu_cf" class="me-2 mb-0" style="min-width: 90px;">控除区分</label>
                    <select name="dedu_item" id="dedu_cf" class="form-control">
                      <% for (let dedu_cf of dedu_cfs) {%>
                        <option value="<%= dedu_cf %>"><%= dedu_cf %></option>
                      <% } %>
                        </select>
                    </div>
                    <div class="d-flex align-items-center mt-2">
                      <label for="dedu_cf2" class="me-2 mb-0" style="min-width: 90px;">控除区分2</label>
                      <select name="dedu_item2" id="dedu_cf2" class="form-control">
                        <% for (let dedu_cf of dedu_cfs) {%>
                          <option value="<%= dedu_cf %>"><%= dedu_cf %></option>
                        <% } %>
                      </select>
                    </div>
                </div>

                <!-- 貯蓄区分 -->
                <div class="form-group category-group text-start mb-2" id="saving_group">
                  <div class="d-flex align-items-center">
                    <label for="saving_cf" class="me-2 mb-0" style="min-width: 90px;">貯蓄区分</label>
                    <select name="saving_item" id="saving_cf" class="form-control">
                      <% for (let saving_cf of saving_cfs) {%>
                        <option value="<%= saving_cf %>"><%= saving_cf %></option>
                      <% } %>
                    </select>
                  </div>
                  <div class="d-flex align-items-center mt-2">
                    <label for="saving_cf2" class="me-2 mb-0" style="min-width: 90px;">貯蓄区分2</label>
                    <select name="saving_item2" id="saving_cf2" class="form-control">
                      <% for (let saving_cf of saving_cfs) {%>
                        <option value="<%= saving_cf %>"><%= saving_cf %></option>
                      <% } %>
                    </select>
                  </div>
                </div>


                <div class="form-group text-start">
                    <label for="payment_cf">支払種別</label>
                    <select name="payment_type" id="payment_cf" class="form-control">
                        <% for (let pay_cf of pay_cfs) {%>
                            <option value="<%= pay_cf %>"><%= pay_cf %></option>
                        <% } %>
                    </select>
                </div>

                <div class="form-group text-start">
                    <label for="who">使用者</label>
                    <select name="user" id="user" class="form-control">
                        <option value="Please Choice">Please Choice</option>
                        <% whos.forEach(who => { %>
                          <option value="<%= who._id %>"><%= who.displayname %></option>
                        <% }) %>
                      </select>
                </div>
                <hr>
                <div class="form-group">
                    <button class="c-button">この条件で検索する</button>
                    <div class="spinner-border text-primary d-none ms-2" role="status" style="width: 1.5rem; height: 1.5rem;">
                        <span class="visually-hidden">送信中...</span>
                    </div>
                </div>
            </form>
        </div>
      </div>
    </div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const cf = document.getElementById("cf");
    const expenseGroup = document.getElementById("expense_group");
    const incomeGroup = document.getElementById("income_group");
    const deductionGroup = document.getElementById("deduction_group");
    const savingGroup = document.getElementById("saving_group");

    function updateCategories() {
      if (!cf || !expenseGroup || !incomeGroup || !deductionGroup || !savingGroup) return;

      expenseGroup.style.display = "none";
      incomeGroup.style.display = "none";
      deductionGroup.style.display = "none";
      savingGroup.style.display = "none";

      if (cf.value === "支出") {
        expenseGroup.style.display = "block";
      } else if (cf.value === "収入") {
        incomeGroup.style.display = "block";
      } else if (cf.value === "控除") {
        deductionGroup.style.display = "block";
      } else if (cf.value === "貯蓄") {
        savingGroup.style.display = "block";
      }
    }

    cf.addEventListener("change", updateCategories);
    updateCategories(); // 初期状態で表示
  });
</script>
